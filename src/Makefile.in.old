CC=@CC@
LD=ld
CFLAGS=@CFLAGS@ -Wall -I.. -DDATADIR=\"$(datadir)\"
LDFLAGS=@LDFLAGS@

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@

OBJS =               	\
	tcpcomm.o       \
	swasynio.o	\
	swauto.o	\
	swcollsn.o	\
	swconf.o	\
	swdisp.o	\
	swend.o		\
	swgames.o	\
	swground.o	\
	swgrpha.o	\
	swinit.o	\
	swmain.o	\
	swmisc.o	\
	swmove.o	\
	swnetio.o	\
	swobject.o	\
	swplanes.o	\
	swsound.o	\
	swsymbol.o	\
	swtitle.o	\
	swutil.o

prefix = @prefix@

exec_prefix = $(prefix)
bindir = $(prefix)/games
srcdir = @srcdir@
datadir = @datadir@

all : @BINS@

gtk/sopwith : sopwith.o
	make -C gtk 

sdl/sopwith : sopwith.o
	make -C sdl

sopwith.o : depends $(OBJS)
	$(LD) $(OBJS) -o $@ -i

%.o : %.c
	$(CC) $(CFLAGS) -c $< -o $@

depends:
	$(CC) $(CFLAGS) -MM *.c > depends
clean:
	make -C sdl clean
	make -C gtk clean
	rm -f $(EXE)
	rm -f $(OBJS)
	rm -f *~

# install

install: installdirs 
	$(INSTALL_PROGRAM) sdl/sopwith $(bindir)/$(binprefix)sopwith
	$(INSTALL_PROGRAM) gtk/sopwith $(bindir)/$(binprefix)gtk-sopwith
installdirs:
	${srcdir}/mkinstalldirs $(bindir) $(datadir)

include depends

